<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>marked-test</title>
    <script src="./lib/marked.js"></script>
	<script src="https://cdn.bootcss.com/lodash.js/4.17.4/lodash.js"></script>
    <!--<script type="text/javascript" src="https://cdn.jsdelivr.net/highlight.js/9.9.0/highlight.min.js"></script>-->
    <link rel="stylesheet" type="text/css" href="./markdown.css">
    <style type="text/css">
        textarea{margin:0;padding:0;}
        .content{
            font-size: 0;
            width:auto;
            min-height: 300px;
            height:600px\9;
            height:90vh;
            border:1px solid #ccc;
        }
        .editor-input, .preview-panel{
            box-sizing: border-box;
            display: inline-block;
            width: 50%;
            height: 100%;
        }
        .editor-input{
            font-size: 14px;
            padding: 10px;
            margin: 0;
            resize: none;
            outline: none;
            border: none;
            border-right: 1px solid #ddd;
            background-color: transparent;
            color: #333;
            font-family: PingFang SC,Lantinghei SC,Helvetica Neue,Helvetica,Arial,Microsoft YaHei,\\微软雅黑,STHeitiSC-Light,simsun,\\宋体,WenQuanYi Zen Hei,WenQuanYi Micro Hei,sans-serif;
        }
        .preview-panel{
            font-family: "Source Sans Pro",sans-serif;
            line-height: 26.1px;
            outline-color: rgb(63, 63, 63);
            outline-style: none;
            outline-width: 0px;
            text-align: justif;
            position: relative;
        }
        code{
            color: #c7254e;
        }
        .markdown-body, layout-resizer{
            box-sizing: border-box;
            display: inline-block;
        }
        .markdown-body{
            font-size: 14px;
            width: 100%;
            height: 100%;
            padding: 10px 10px 10px 35px;
            overflow: auto;
        }
        .layout-resizer{
            position: absolute;
            left: 0px;
            top:0px;
            height: 100%;
            width: 15px;
            cursor: col-resize;
        }
    </style>
</head>
<body>
<div id="content" class="content"><textarea id="myEditor" spellcheck="false" class="editor-input"></textarea><div class="preview-panel"><div id="resizer" class="layout-resizer"></div><div id="myView" class="markdown-body"></div></div>
</div>
<script>
    (function(global) {
        /*marked.setOptions({
            highlight: function (code) {
                console.log(code)
                return hljs.highlightAuto(code).value;
            }
        })*/
        if (document.addEventListener){
            document.addEventListener("DOMContentLoaded", function Loaded(){
                document.getElementById('myEditor').addEventListener("input", _.debounce(function(){
                    document.getElementById('myView').innerHTML = marked(this.value?this.value:"", { sanitize: true })
                }), 400)
				var flag = false
				document.getElementById('resizer').addEventListener('mousedown', function(e){
					if (e.button !== 0) {
						return false
					}
					var content = document.getElementById('content')
					var myEditor = document.getElementById('myEditor')
					var myView = document.querySelector('.preview-panel')
					var contentWidth = content.offsetWidth
					var editorWidth = myEditor.offsetWidth
					var viewWidth = myView.offsetWidth
					var body = document.querySelector('body')
					var cursor = body.style.cursor
					var editorCursor = myEditor.style.cursor
					var oldclientX = e.clientX
					body.style.cursor = 'col-resize'
					myEditor.style.cursor = 'col-resize'
					var pageX = e.pageX
					var onmousemove = _.throttle(function (e){
						var offset = pageX - e.pageX
						var newViewWidth = (viewWidth + offset) / contentWidth * 100
						var newEditorWidth = 100 - newViewWidth
                        if (newViewWidth > 20 && newViewWidth < 80){
                            myEditor.style.width = newEditorWidth + '%'
                            myView.style.width = newViewWidth + '%'
                        }

					}, 30)
					function onmouseup(e) {
						body.style.cursor = cursor
						myEditor.style.cursor = editorCursor
						flag = false
						body.removeEventListener('mouseup', onmouseup)
						body.removeEventListener('mousemove', onmousemove)
					}
					body.addEventListener('mouseup', onmouseup)
					body.addEventListener('mousemove', onmousemove)
				})
                document.removeEventListener("DOMContentLoaded", Loaded)
            })
        }else{
            document.getElementById('myEditor').onchange=function(){
                console.log('onchange')
                document.getElementById('myView').innerHTML = marked(this.value?this.value:"", { sanitize: true })
            }
        }
    })(this)
</script>
</body>
</html>
